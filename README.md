# Dockerize Confluent Kafka Connect Worker

Build docker image for secured confluent kafka Connect worker in your local docker environment with Debzeium MySQL connector and JDBC source/sink connector. Subsequently deploy the kafka connect worker in kubernetes cluster in a distributed way. 

The image is available directly from [Docker Hub](https://hub.docker.com/r/wurstmeister/kafka/)
### Prerequisite
 - You have a local kafka cluster running in any of the PLAINTEXT, SSL, SASL_PLAINTEXT, SASL_SSL mode.
 -  You have a schema registry server running with/without SSL mode.
 -  You want to convert data for Kafka Connect to and from in Avro format.
 -  For testing query based CDC connector a MySQL DB server is configured and running.
 -  For rebuilding Docker image, install docker with buildx plugin as described [here](https://docs.docker.com/engine/install/ubuntu/).

### Usage
#### Use case - I
Run Kafka connect worker with Kafka broker listener configured in PLAINTEXT mode. The schema registry is running in either secured or non-secured mode.

    $ docker run -d --name=connect-worker-1 -e BOOTSTRAP_SERVERS="kafka:9092" -e SECURITY_PROTOCOL="PLAINTEXT" -e REST_HOST_NAME="connect-worker-1"  -e LISTENER_PORT="8081" -e REST_ADVERTISED_HOST_NAME="connect-worker-1"  -e REST_ADVERTISED_LISTENER="http" -e SCHEMA_REGISTRY_MODE="HTTP" -e BROKER_LISTENER_MODE="PLAINTEXT"  -e KAFKA_JMX_HOSTNAME="connect-worker-1" -e KAFKA_JMX_PORT="8080" -e SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" -e KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=8080 -Djava.rmi.server.hostname=connect-worker-1 -javaagent:/u01/cnfkfk/etc/kafka/jmx_prometheus_javaagent-0.20.0.jar=8080:/u01/cnfkfk/etc/kafka/kafka-connect.yml" dwijad/kafka-connect:latest 

#### Use case - II
Run Kafka connect worker with Kafka broker listener configured in SSL mode. The schema registry is running in either secured or non-secured mode.

    Schema registry is running in http
    $ docker run -d --name=connect-worker-1 -e BOOTSTRAP_SERVERS="kafka:9092" -e SECURITY_PROTOCOL="SSL" -e REST_HOST_NAME="connect-worker-1"  -e LISTENER_PORT="8081" -e REST_ADVERTISED_HOST_NAME="connect-worker-1"  -e REST_ADVERTISED_LISTENER="https" -e SCHEMA_REGISTRY_MODE="HTTP" -e BROKER_LISTENER_MODE="SSL"  -e KAFKA_JMX_HOSTNAME="connect-worker-1" -e KAFKA_JMX_PORT="8080" -e SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" -e KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=8080 -Djava.rmi.server.hostname=connect-worker-1 -javaagent:/u01/cnfkfk/etc/kafka/jmx_prometheus_javaagent-0.20.0.jar=8080:/u01/cnfkfk/etc/kafka/kafka-connect.yml" dwijad/kafka-connect:latest 
    
    Schema registry is running in https
    $ docker run -d --name=connect-worker-1 -e BOOTSTRAP_SERVERS="kafka:9092" -e SECURITY_PROTOCOL="SSL" -e REST_HOST_NAME="connect-worker-1"  -e LISTENER_PORT="8081" -e REST_ADVERTISED_HOST_NAME="connect-worker-1"  -e REST_ADVERTISED_LISTENER="https" -e SCHEMA_REGISTRY_MODE="HTTPS" -e BROKER_LISTENER_MODE="SSL"  -e KAFKA_JMX_HOSTNAME="connect-worker-1" -e KAFKA_JMX_PORT="8080" -e SCHEMA_REGISTRY_URL="https://sr-service-https.default.svc:8082" -e KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=8080 -Djava.rmi.server.hostname=connect-worker-1 -javaagent:/u01/cnfkfk/etc/kafka/jmx_prometheus_javaagent-0.20.0.jar=8080:/u01/cnfkfk/etc/kafka/kafka-connect.yml" dwijad/kafka-connect:latest

#### Use case - III
Run Kafka connect worker with Kafka broker listener configured in SASL_SSL mode. The schema registry is running in either secured or non-secured mode.

    Schema registry is running in http
    $ docker run -d --name=connect-worker-1 -e BOOTSTRAP_SERVERS="kafka:9092" -e SECURITY_PROTOCOL="SASL_SSL" -e REST_HOST_NAME="connect-worker-1"  -e LISTENER_PORT="8081" -e REST_ADVERTISED_HOST_NAME="connect-worker-1"  -e REST_ADVERTISED_LISTENER="https" -e SCHEMA_REGISTRY_MODE="HTTP" -e BROKER_LISTENER_MODE="SASL_SSL"  -e KAFKA_JMX_HOSTNAME="connect-worker-1" -e KAFKA_JMX_PORT="8080" -e SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" -e KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=8080 -Djava.rmi.server.hostname=connect-worker-1 -javaagent:/u01/cnfkfk/etc/kafka/jmx_prometheus_javaagent-0.20.0.jar=8080:/u01/cnfkfk/etc/kafka/kafka-connect.yml" -e SASL_USER=user1 -e SASL_PASSWORD=password -e KEY_CONVERTER_SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" -e VALUE_CONVERTER_SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" dwijad/kafka-connect:latest 
    
    Schema registry is running in https
    $ docker run -d --name=connect-worker-1 -e BOOTSTRAP_SERVERS="kafka:9092" -e SECURITY_PROTOCOL="SASL_SSL" -e REST_HOST_NAME="connect-worker-1"  -e LISTENER_PORT="8081" -e REST_ADVERTISED_HOST_NAME="connect-worker-1"  -e REST_ADVERTISED_LISTENER="https" -e SCHEMA_REGISTRY_MODE="HTTPS" -e BROKER_LISTENER_MODE="SASL_SSL"  -e KAFKA_JMX_HOSTNAME="connect-worker-1" -e KAFKA_JMX_PORT="8080" -e SCHEMA_REGISTRY_URL="https://sr-service-https.default.svc:8082" -e KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=8080 -Djava.rmi.server.hostname=connect-worker-1 -javaagent:/u01/cnfkfk/etc/kafka/jmx_prometheus_javaagent-0.20.0.jar=8080:/u01/cnfkfk/etc/kafka/kafka-connect.yml" -e SASL_USER=user1 -e SASL_PASSWORD=password -e KEY_CONVERTER_SCHEMA_REGISTRY_URL="https://sr-service-https.default.svc:8082" -e VALUE_CONVERTER_SCHEMA_REGISTRY_URL="https://sr-service-https.default.svc:8082" dwijad/kafka-connect:latest

#### Use case - IV
Run Kafka connect worker with Kafka broker listener configured in SASL_PLAINTEXT mode. The schema registry is running in either secured or non-secured mode.

    Schema registry is running in http
    $ docker run -d --name=connect-worker-1 -e BOOTSTRAP_SERVERS="kafka:9092" -e SECURITY_PROTOCOL="SASL_PLAINTEXT" -e REST_HOST_NAME="connect-worker-1"  -e LISTENER_PORT="8081" -e REST_ADVERTISED_HOST_NAME="connect-worker-1"  -e REST_ADVERTISED_LISTENER="http" -e SCHEMA_REGISTRY_MODE="HTTP" -e BROKER_LISTENER_MODE="SASL_PLAINTEXT"  -e KAFKA_JMX_HOSTNAME="connect-worker-1" -e KAFKA_JMX_PORT="8080" -e SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" -e KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=8080 -Djava.rmi.server.hostname=connect-worker-1 -javaagent:/u01/cnfkfk/etc/kafka/jmx_prometheus_javaagent-0.20.0.jar=8080:/u01/cnfkfk/etc/kafka/kafka-connect.yml" -e SASL_USER=user1 -e SASL_PASSWORD=password -e KEY_CONVERTER_SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" -e VALUE_CONVERTER_SCHEMA_REGISTRY_URL="http://sr-service-http.default.svc:8081" dwijad/kafka-connect:latest 
    
    Schema registry is running in https
    $ docker run -d --name=connect-worker-1 -e BOOTSTRAP_SERVERS="kafka:9092" -e SECURITY_PROTOCOL="SASL_PLAINTEXT" -e REST_HOST_NAME="connect-worker-1"  -e LISTENER_PORT="8081" -e REST_ADVERTISED_HOST_NAME="connect-worker-1"  -e REST_ADVERTISED_LISTENER="http" -e SCHEMA_REGISTRY_MODE="HTTPS" -e BROKER_LISTENER_MODE="SASL_PLAINTEXT"  -e KAFKA_JMX_HOSTNAME="connect-worker-1" -e KAFKA_JMX_PORT="8080" -e SCHEMA_REGISTRY_URL="https://sr-service-https.default.svc:8082" -e KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=8080 -Djava.rmi.server.hostname=connect-worker-1 -javaagent:/u01/cnfkfk/etc/kafka/jmx_prometheus_javaagent-0.20.0.jar=8080:/u01/cnfkfk/etc/kafka/kafka-connect.yml" -e SASL_USER=user1 -e SASL_PASSWORD=password -e KEY_CONVERTER_SCHEMA_REGISTRY_URL="https://sr-service-https.default.svc:8082" -e VALUE_CONVERTER_SCHEMA_REGISTRY_URL="https://sr-service-https.default.svc:8082" dwijad/kafka-connect:latest

### Using docker compose

### Docker environment variable
    Name: UID
    Default value: 1000
    Description: User ID used to build Dockerfile   

    Name: GID
    Default value: 1000
    Description: Group ID used to build Dockerfile

    Name: USERNAME 
    Default value: kafka
    Description: Kafka 

    USERNAME=kafka \
    BOOTSTRAP_SERVERS \
    GROUP_ID \
    KEY_CONVERTER \
    VALUE_CONVERTER \
    KEY_CONVERTER_SCHEMAS_ENABLE \
    VALUE_CONVERTER_SCHEMAS_ENABLE \
    OFFSET_STORAGE_TOPIC \
    CONFIG_STORAGE_TOPIC \
    STATUS_STORAGE_TOPIC \
    REST_HOST_NAME \
    LISTENER_PORT \
    REST_ADVERTISED_HOST_NAME \
    PLUGIN_PATH \
    CONFIG_PROVIDERS \
    CONFIG_PROVIDERS_FILE_CLASS \
    SSL_ENDPOINT_IDENTIFICATION_ALGORITHM \
    REQUEST_TIMEOUT_MS \
    RETRY_BACKOFF_MS \
    SECURITY.PROTOCOL \
    SSL_PROTOCOL \
    SSL_TRUSTSTORE_LOCATION \
    SSL_TRUSTSTORE_PASSWORD \
    SSL_KEYSTORE_LOCATION \
    SSL_KEYSTORE_PASSWORD \
    SSL_KEY_PASSWORD \
    CONSUMER_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM \
    CONSUMER_REQUEST_TIMEOUT_MS \
    CONSUMER_RETRY_BACKOFF_MS \
    CONSUMER_SECURITY_PROTOCOL \
    CONSUMER_SSL_PROTOCOL \
    CONSUMER_SSL_TRUSTSTORE_LOCATION \
    CONSUMER_SSL_TRUSTSTORE_PASSWORD \
    CONSUMER_SSL_KEYSTORE_LOCATION \
    CONSUMER_SSL_KEYSTORE_PASSWORD \
    CONSUMER_SSL_KEY_PASSWORD \
    PRODUCER_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM \
    PRODUCER_REQUEST_TIMEOUT_MS \
    PRODUCER_RETRY_BACKOFF_MS \
    PRODUCER_SECURITY_PROTOCOL \
    PRODUCER_SSL_PROTOCOL \
    PRODUCER_SSL_TRUSTSTORE_LOCATION \
    PRODUCER_SSL_TRUSTSTORE_PASSWORD \
    PRODUCER_SSL_KEYSTORE_LOCATION \
    PRODUCER_SSL_KEYSTORE_PASSWORD \
    PRODUCER_SSL_KEY_PASSWORD \
    SASL_JAAS_CONFIG \
    PRODUCER_SASL_JAAS_CONFIG \
    CONSUMER_SASL_JAAS_CONFIG \
    SASL_MECHANISM \
    PRODUCER_SASL_MECHANISM \
    CONSUMER_SASL_MECHANISM \
    SASL_USER \
    SASL_PASSWORD \
    KEY_CONVERTER_SCHEMA_REGISTRY_SSL_TRUSTSTORE_LOCATION \
    KEY_CONVERTER_SCHEMA_REGISTRY_SSL_KEYSTORE_LOCATION \
    KEY_CONVERTER_SCHEMA_REGISTRY_SSL_KEYSTORE_PASSWORD \
    KEY_CONVERTER_SCHEMA_REGISTRY_SSL_KEY_PASSWORD \
    KEY_CONVERTER_SCHEMA_REGISTRY_URL \
    KEY_CONVERTER_BASIC_AUTH_CREDENTIALS_SOURCE \
    KEY_CONVERTER_BASIC_AUTH_USER_INFO \
    KEY_CONVERTER_SCHEMA_REGISTRY_SSL_TRUSTSTORE_TYPE \
    VALUE_CONVERTER_SCHEMA_REGISTRY_SSL_TRUSTSTORE_LOCATION \
    VALUE_CONVERTER_SCHEMA_REGISTRY_SSL_KEYSTORE_LOCATION \
    VALUE_CONVERTER_SCHEMA_REGISTRY_SSL_KEYSTORE_PASSWORD \
    VALUE_CONVERTER_SCHEMA_REGISTRY_SSL_KEY_PASSWORD \
    VALUE_CONVERTER_SCHEMA_REGISTRY_URL \
    VALUE_CONVERTER_BASIC_AUTH_CREDENTIALS_SOURCE \
    VALUE_CONVERTER_BASIC_AUTH_USER_INFO \
    VALUE_CONVERTER_SCHEMA_REGISTRY_SSL_TRUSTSTORE_TYPE \
    SCHEMA_REGISTRY_URL \
    SCHEMA_REGISTRY_SSL_TRUSTSTORE_PASSWORD \
    SCHEMA_REGISTRY_SSL_TRUSTSTORE_LOCATION \
    SCHEMA_REGISTRY_SSL_KEYSTORE_PASSWORD \
    SCHEMA_REGISTRY_SSL_KEYSTORE_LOCATION \
    SCHEMA_REGISTRY_SSL_KEY_PASSWORD \
    SCHEMA_REGISTRY_BASIC_AUTH_CREDENTIALS_SOURCE \
    SCHEMA_REGISTRY_BASIC_AUTH_USER_INFO \
    LISTENERS \
    REST_ADVERTISED_LISTENER \
    KAFKA_JMX_PORT \
    KAFKA_JMX_HOSTNAME \
    KAFKA_JMX_OPTS \
    BROKER_LISTENER_MODE \
    SCHEMA_REGISTRY_MODE \
    KEY_CONVERTER_SCHEMAS_ENABLE \
    VALUE_CONVERTER_SCHEMAS_ENABLE

https://github.com/1ambda/docker-kafka-connect
https://github.com/SAP/kafka-connect-sap
https://github.com/debezium/debezium
https://github.com/wurstmeister/kafka-docker
https://joelforjava.com/blog/2019/10/27/adding-ssl-encryption-to-kafka-connector.html 
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEwNzczNTg4NTAsMzM2NTAyNDYzLDE4OT
gzMTA1NDQsLTIxOTQ2MDY1NCwtMjAyMzc5MjUyMSwtMTE5ODAz
NTI5MCwtNTgxOTg5ODQ0LDExMzk2OTMwNjEsMjc4NTQzODE0LD
kyOTA2MzYxOSw5OTExMTMxNjQsMjAxNDEyMzc2NSwtODc4Nzcx
MDE3LC00ODI0Mjk2NDcsNzE5MjA1MjYwXX0=
-->